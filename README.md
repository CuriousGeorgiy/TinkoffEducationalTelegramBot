# Телеграм-бот для [образовательных программ Tinkoff](https://fintech.tinkoff.ru/study/generation/)

*Георгий Лебедев,*

*куратор [Андрей Гаркавый](https://vk.com/andrewgark)*

## Цель и задачи проекта

Основной целью проекта было создать телеграм-бота, который мог бы осуществлять сопровождение учащихся, отвечая на ЧАВО и давая персонализированные ответы
(например, о расписании занятий), а также рассылая им напоминания в виде пуш-уведомлений о различных мероприятиях и занятиях.

В частности, ставились задачи:
* придумать разумный алгоритм обработки запросов к боту
* придумать удобный пользовательский интерфейс для администрирования бота (авторизации и добавления сведений об учащихся, добавления новых вопросов-ответов, напоминаний
и мероприятий)
* придумать, как хостить бота в условиях блокировки Telegram'а РКН
* создать MVP

Предполагалось, что работа над проектом займет примерно один месяц.

## Реализация
Для создания прототипа был выбран высокоуровневый язык Python. 

Для работы с Telegram Bot API была выбрана библиотека
[python-telegram-bot](https://github.com/python-telegram-bot/python-telegram-bot) — среди прочих достоинств обработка сообщений пользователей в ней реализована
посредством callback-функций, также она поддерживает их асинхронную обработку.  

В качестве интерфейса для администрирования бота и одновременно базы данных были выбраны Google Sheets, с которыми достаточно легко работать и нет необходимости создавать
отдельное клиентское приложение для редактирования базы данных. Для работы с ними на стороне бэкенда использовался [Google Sheets API](https://developers.google.com/sheets/api).

Поскольку для использования методов машинного обучения требуется обучающая выборка, которой на момент создания бота не было, решено было использовать регулярные выражения
для фильтрации запросов к боту: каждое пользовательское сообщение линейно проходило через набор фильтров, пока не удовлетворяло одному из них. На одном из листов таблицы
находился список пар вопрос-ответ, где вопрос был сформулирован в виде простого регулярного выражения, так что администратору никаких специфических знаний для добавления
новых вопросов не требовалось.

Другой лист содержал сведения об авторизованных пользователях, в том числе класс и посещаемые занятия. Авторизация пользователей производилась по номеру телефона в
Telegram'е: новые пользователи добавлялись в таблицу, по ней проверялось, авторизованы ли они администратором.

Последний лист содержал текстовые напоминания с временем отправления и группами пользователей, которым они должны были рассылаться. На стороне бэкенда для этого создавались
job'ы, реализованные в python-telegram-bot.

Для поддержания состояния бота использовалась cериализация в JSON файл с данными об авторизованных пользователя.

Для хостинга использовалась виртуальная машина (ВМ) на базе Google Compute Engine, развертывание осуществлялось через git и virtualenv с помощью bash-скрипта на стороне ВМ.

## Результат
Создан MVP, в которым были реализованы все задуманные фукнции, удовлетворивший заказчика.

